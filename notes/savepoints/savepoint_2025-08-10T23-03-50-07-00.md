# Save Point Reboot Prompt — rolodexterVS + Joe

Generated: 2025-08-10T23:03:50-07:00
Context: Riskill Cinematic Overlay (Vite + React + TypeScript)
Environment: Windows (local), Netlify/Windsurf preview: https://riskill-chat-overlay.windsurf.build

Use this as the first message in a fresh chat to continue seamlessly.

---

## 0) Quick resume instructions
- You are rolodexterVS (Windsurf/Cascade). Joe is the product/engineering counterpart.
- Goal now: UI/UX QA, documentation, deploy, and audits for the Risk Index widget and unified Messenger handoff.
- When resuming: open `src/widgets/RiskIndex.tsx`, `src/widgets/CardWidget.tsx`, `src/ui/InlineDisclosureLink.tsx`, `src/ui/Disclosure.tsx`, and `src/utils/messenger.ts`.

---

## 1) Working memory state (what’s true right now)
- __Overlay & portal__: Disclosures render via React portal into `#dashboard-overlay` in `index.html` with viewport clamping and event swallowing. Singleton disclosure enforced.
- __Risk Index__: Stacked faces/rotator pattern with mouse wheel/trackpad/touch cycling; auto-rotation pauses on disclosure open/hover/focus; emits telemetry (`risk.scroll.cycle`, `risk.index.refresh`, `risk.drilldown.open`, `risk.domain.toggle`). Numeric-first; gauge view deferred.
- __Scroll arbitration__: While pointer hovers a card, wheel cycles faces first; page does not scroll unless rotation is not triggered. Off-card, page scrolls normally. Touch: quick vertical flick cycles; slow drag lets page scroll. Reduced-motion crossfades preserved. No CLS observed locally.
- __Messenger handoff__: Unified via `messengerHandoff()` helper. Disclosure sheets and inline links include standardized “Discuss in Messenger →”. Handoff payload includes `source`, `intent`, optional `faceId`, `title`, `anchorEl/anchorRect`, and `meta` (e.g., `glossaryKey`, `domainId`). Chat window listens for `progressive.open`.
- __Top-row transparency__: KPI band sets `--rk-card-alpha=0.60` for top widgets. `CardWidget` reads var for backgrounds.
- __Telemetry__: Sampled event emission; close reasons tracked for disclosures.

---

## 2) Task flow and current plan
- Completed
  - __Capture-phase wheel__: `CardWidget` attaches native `wheel` listener `{ passive: false, capture: true }` and forwards to `onWheel`. React `onWheel` removed to avoid duplicate handling.
  - __Risk Index wheel__: Moved rotation logic to `CardWidget.onWheel` with 220ms throttle; preventDefault only when rotating.
  - __Messenger standardization__: `messengerHandoff` created; integrated into `Disclosure` and `InlineDisclosureLink`; Risk Index uses it for inline domain links and trends face link.
  - __Inline disclosure props__: `InlineDisclosureLink` accepts `faceId`, `handoffSource`, `handoffMeta` and passes them to Explainer → `messengerHandoff`.
  - __Docs/notes__: Reboot prompt for rolodexterGPT saved separately under `notes/handoffs/`.
- Pending
  - Deploy to preview and run Lighthouse + axe; record in `WORKLOG.md`.
  - Standardize wheel interception across any other stacked widgets (verify Operations parity).
  - Update `README.md`, `PROJECT_STRUCTURE.md`, `WORKLOG.md` with: disclosure footer standard, messenger contract, scroll interception policy, a11y notes.
  - Telemetry validation in dashboards for messenger events and Risk Index events.
  - UI/UX polish for Risk Index stacked faces; optional gauge view scheduling.

---

## 3) Relevant project files (paths)
- `src/utils/messenger.ts` — unified handoff helper.
- `src/ui/InlineDisclosureLink.tsx` — inline glossary links; props: `faceId`, `handoffSource`, `handoffMeta`; emits disclosure events; uses `messengerHandoff` in footer.
- `src/ui/Disclosure.tsx` — Disclosure sheet; standardized footer link using `messengerHandoff`.
- `src/widgets/CardWidget.tsx` — shared card chrome and interactive wrapper; capture-phase wheel listener via `ref` + `useEffect`.
- `src/widgets/RiskIndex.tsx` — stacked faces & rotation; uses `onWheel` at card root; `buildFaces(data, anchorEl)` for anchor-aware messenger links.
- Overlay mount in `index.html`: `#dashboard-overlay`.

---

## 4) Agent assignments and roles
- __rolodexterVS (you)__: agentic coding assistant; owns code changes, QA, audits, deployments, and documentation updates.
- __Joe__: product/engineering partner; approves UX copy/thresholds/ARIA, validates behavior and telemetry.

---

## 5) System constraints and environment
- Tooling: Vite 7, React, TypeScript, Tailwind, Framer Motion.
- Strict lint and a11y/perf targets.
- Windows OS; Node/NPM scripts available.
- Netlify/Windsurf deployment target; live preview URL listed above.

---

## 6) Naming conventions and event contracts
- Messenger handoff `source` values: `disclosure-inline`, `risk-index` (current usage).
- `messengerHandoff` payload:
  - Required: `source`, `intent` (e.g., `discuss`, `open`).
  - Optional: `faceId`, `cardId`, `title`, `primary`, `narrative`, `metrics`, `anchorEl` or `anchorRect`, `meta` (structured details like `glossaryKey`, `domainId`, `action`).
- Disclosure telemetry: emit open/close with reasons; close reasons include `close`, `handoff`, etc.

---

## 7) Unresolved threads and risks
- Confirm wheel throttle (220ms) and delta scaling policy; ensure feel is consistent across touchpads/mice.
- Ensure Operations or other widgets adopt capture-phase scroll pattern for parity.
- Validate anchor-based chat placement on various viewport sizes; ensure `#dashboard-overlay` remains stable.
- Complete Lighthouse/axe audits; fix critical issues (contrast, labels, focus traps) if found.
- Gauge view roadmap: decide timing and design requirements.

---

## 8) How to run and validate
- Dev: `npm run dev` (local preview); test wheel/scroll behavior on/off-card; test disclosures and messenger links.
- Build: `npm run build` (already tested successfully).
- Deploy: use existing Netlify/Windsurf flow; then run Lighthouse + axe; record metrics in `WORKLOG.md`.

---

## 9) Acceptance checklist for the next session
- __Scroll arbitration__: While hovered, first wheel notch rotates; off-card, page scroll is normal. Touch flick vs slow drag works.
- __Reduced motion__: crossfades; no flashy transitions.
- __No CLS__: verify via Lighthouse.
- __No console warnings__: interact through disclosures and messenger links.
- __Telemetry__: messenger open events emitted with normalized payload; Risk Index events flowing.
- __Docs updated__: event contract, disclosure standards, scroll policy, and QA notes.

---

## 10) Prompt to resume
When the next session starts, begin with:
- Review `RiskIndex.tsx` for the `onWheel` handler and ensure feel is right on multiple devices.
- Run a deploy, then Lighthouse and axe. Paste metrics and issues into `WORKLOG.md` with a triage list.
- Confirm Operations widget uses the capture-phase pattern; if not, migrate.
- Update docs (`README.md`, `PROJECT_STRUCTURE.md`, `WORKLOG.md`) to reflect standards and contracts.
- Verify messenger telemetry dashboards reflect the new fields.

If any regressions appear (page scroll wins; warnings; a11y issues), prioritize fixes before adding features (e.g., gauge view).
